{% extends 'base.html.twig' %}

{% block title %}Paiement Stripe{% endblock %}

{% block body %}
    <div class="container mt-5 text-center">
        <h1>Paiement</h1>
        <button id="checkout-button" class="btn btn-success">ðŸ’³ Payer {{ total|number_format(2, ',', ' ') }} â‚¬</button>
    </div>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        const stripe = Stripe("{{ stripe_public_key }}");

        document.getElementById("checkout-button").addEventListener("click", () => {
            fetch("{{ path('stripe_checkout') }}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({}) // On pourrait ajouter plus de donnÃ©es si besoin
            })
            .then(res => res.json())
            .then(data => {
                if (data.id) {
                    stripe.redirectToCheckout({ sessionId: data.id });
                } else {
                    alert("Erreur lors de la crÃ©ation de la session Stripe.");
                    console.error(data);
                }
            })
            .catch(err => console.error("Erreur Stripe :", err));
        });
    </script>
{% endblock %}
